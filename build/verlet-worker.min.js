!function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.points=[],this.pointMap=new Map,this.constraints=[],this.constraintMap=new Map,this.forceMap=new Map,this.addForce=function(e){var i=new y(e);return i.id=p++,t.forceMap.set(i.id,i),i},this.addPoint=function(e){var i=new h(e),n=void 0,o=t.pointMap.values();for(i.id=p++,i.verletPoint.id=i.id;n=o.next(),!n.done&&(n=n.value);)(i.attraction||n.attraction&&i!==n)&&t.connect(i.verletPoint,n.verletPoint,{stiffness:(i.attraction||0)+(n.attraction||0),restingDistance:i.verletPoint.radius+n.verletPoint.radius,range:"contact"===i.attractionRange?i.verletPoint.radius+n.verletPoint.radius:i.attractionRange?Number(i.attractionRange):1/0});return t.points.push(i.verletPoint),t.pointMap.set(i.id,i),i},this.removePoint=function(e){t.pointMap.get(e).constraints.forEach(function(e){return t.removeConstraint(e)}),t.pointMap.delete(e),t.needsUpdate=!0},this.connect=function(e,i,n){n||(n={stiffness:.05,restingDistance:e.radius+i.radius});var o=new f([e,i],n);return o.range=n.range||1/0,o.breakingDistance=n.breakingDistance||1/0,o.id=p++,t.constraints.push(o),t.constraintMap.set(o.id,o),o.id},this.removeConstraint=function(e){t.constraintMap.delete(e),t.needsUpdate=!0};var i={gravity:e.gravity?[0,e.gravity,0]:void 0,friction:.99};e.boxSize&&(i.min=[-e.size.x/2,-e.size.y/2,-e.size.z/2],i.min=[e.size.x/2,e.size.y/2,e.size.z/2]),"number"==typeof e.floor&&e.floor!==-(1/0)&&(i.min=[null,e.floor,null],i.max=[null,null,null]),this.world=new u(i),this.world.forces=[],this.world.forceMap=new Map;var o=0;this.animate=function(){var t=Date.now();if(0===o&&(o=t-16),this.needsUpdate){var e,i;this.points.splice(0),(e=this.points).push.apply(e,n(Array.from(this.pointMap.values()).map(function(t){return t.verletPoint}))),this.constraints.splice(0),(i=this.constraints).push.apply(i,n(this.constraintMap.values())),this.needsUpdate=!1}if(!(t-o<8)){var r=(t-o)/1e3;r>.032&&console.warn("Long frame: "+r);for(var s=0,a=this.constraints.length;s<a;s++){var c=this.constraints[s];if(c.range&&c.range!==1/0||c.breakingDistance&&c.breakingDistance!==1/0){var p=v.distance(c.points[0].position,c.points[1].position);if(p>c.breakingDistance){this.removeConstraint(c.id);continue}if(p>c.range)continue}c.solve()}if(this.world.needsForceUpdate){var u;this.world.needsForceUpdate=!1,this.world.forces.splice(0),(u=this.world.forces).push.apply(u,n(this.world.forceMap.values()))}for(var f=0,d=this.points.length;f<d;f++){var h=this.points[f];if(h.needsForceUpdate){var y;h.needsForceUpdate=!1,h.forces.splice(0),(y=h.forces).push.apply(y,n(h.forceMap.values()))}for(var m=0,g=this.world.forces.length;m<g;m++){var b=this.world.forces[m];b.expire?this.world.forceMap.delete(b.id):b.applyForce(h)}for(var w=0,M=h.forces.length;w<M;w++){var x=h.forces[w];x.expire?h.forceMap.delete(x.id):x.applyForce(h)}}this.world.integrate(this.points,r*l),o=t}}}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(){function t(t,e){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();importScripts("https://cdn.polyfill.io/v2/polyfill.js?features=es6");var p=100,u=i(10),f=i(23),d=i(27),l=1,v={distance:i(25),scaleAndAdd:i(29)},h=function t(e){var i=e.position,n=void 0===i?{x:0,y:0,z:0}:i,r=e.radius,s=void 0===r?1:r,a=e.mass,c=void 0===a?1:a,p=e.attraction,u=void 0===p?0:p,f=e.attractionRange,l=void 0===f?1/0:f,v=e.velocity,h=void 0===v?{x:0,y:0,z:0}:v;o(this,t),this.initialRadius=s,this.initialMass=c,this.attraction=u,this.attractionRange=l,this.constraints=[],this.forces=[],this.forceMap=new Map,this.verletPoint=new d({position:[n.x,n.y,n.z],mass:c,radius:s,attraction:u}).addForce([h.x,h.y,h.z]),this.verletPoint.forces=this.forces,this.verletPoint.forceMap=this.forceMap},y=function(){function t(e){if(o(this,t),this.update(e),!this.vector)throw Error("Force Vector has not been defined")}return c(t,[{key:"update",value:function(t){var e=t.vector;e&&(this.vector=[e.x,e.y,e.z])}},{key:"applyForce",value:function(t){v.scaleAndAdd(t.acceleration,t.acceleration,this.vector,1/t.mass)}}]),t}(),m=void 0;self.addEventListener("message",function(t){var e=[],i=t.data.map(function(t){var i=a(t,2),n=i[0],o=i[1],c=o,p=function(){switch(c.action){case"init":return m=new r(c.options),{v:{id:n}};case"getPoints":var t=new Float32Array(c.byteData);m.animate();for(var i=0,o=0,s=m.points.length;o<s;o++){var a=m.points[o];a&&(t[i+0]=a.id,t[i+1]=a.position[0],t[i+2]=a.position[1],t[i+3]=a.position[2],i+=4)}return e.push(t.buffer),{v:{id:n,byteData:t.buffer,length:m.points.length}};case"noopPoints":return{v:{id:n,byteData:c.byteData,length:m.points.length}};case"createForce":var p=m.addForce(c.forceOptions);return m.forceMap.set(p.id,p),c.targets.forEach(function(t){if("world"===t)m.world.forceMap.set(p.id,p),m.world.needsForceUpdate=!0;else{var e=m.pointMap.get(t);e.verletPoint.needsForceUpdate=!0,e.forceMap.set(p.id,p)}}),{v:{id:n,forceId:p.id}};case"useForce":var u=m.forceMap.get(c.forceId);return c.targets.forEach(function(t){if("world"===t)m.world.forceMap.set(u.id,u),m.world.needsForceUpdate=!0;else{var e=m.pointMap.get(t);e.needsForceUpdate=!0,e.forceMap.set(u.id,u)}}),{v:{id:n,forceId:u.id}};case"updateForce":return m.forceMap.get(c.forceId).update(c.forceOptions),{v:{id:n}};case"removeForce":return m.forceMap.get(c.forceId).expire=!0,{v:{id:n}};case"connectPoints":var f=m.pointMap.get(c.options.id1),d=m.pointMap.get(c.options.id2),l=m.connect(f.verletPoint,d.verletPoint,c.options.constraintOptions);return f.constraints.push(l),d.constraints.push(l),{v:{id:n,constraintId:l}};case"removeConstraint":return m.removeConstraint(c.options.constraintId),{v:{id:n}};case"updateConstraint":var v=m.constraintMap.get(c.options.constraintId);return void 0!==c.options.stiffness&&(v.stiffness=c.options.stiffness),void 0!==c.options.restingDistance&&(v.restingDistance=c.options.restingDistance),{v:{id:n}};case"addPoint":return{v:{id:n,point:m.addPoint(c.pointOptions),length:m.points.length}};case"removePoint":return m.removePoint(c.options.id),{v:{id:n}};case"updatePoint":var h=c.pointOptions,y=m.pointMap.get(h.id);return void 0!==h.position&&y.verletPoint.place([h.position.x,h.position.y,h.position.z]),void 0!==h.velocity&&y.verletPoint.addForce([h.velocity.x,h.velocity.y,h.velocity.z]),void 0!==h.mass&&(y.verletPoint.mass=h.mass),void 0!==h.radius&&(y.verletPoint.radius=h.radius),{v:{id:n}};case"reset":return m.points.splice(0),m.pointMap=new Map,m.constraints.splice(0),m.constraintMap=new Map,{v:{id:n}};default:return{v:{error:"Invalid Action: "+c.action,id:n}}}}();if("object"===("undefined"==typeof p?"undefined":s(p)))return p.v});self.postMessage(i,e)}),self.postMessage({id:"handshake"})},,,,,,,,,,function(t,e,i){var n={create:i(11),add:i(12),multiply:i(13),sub:i(14),scale:i(15),copy:i(16),sqrLen:i(17),fromValues:i(18)};t.exports=i(19)(n)},function(t,e){function i(){var t=new Float32Array(3);return t[0]=0,t[1]=0,t[2]=0,t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}t.exports=i},function(t,e){function i(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}t.exports=i},function(t,e){function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}t.exports=i},function(t,e){function i(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n}t.exports=i},function(t,e){function i(t,e,i){var n=new Float32Array(3);return n[0]=t,n[1]=e,n[2]=i,n}t.exports=i},function(t,e,i){var n=i(20),o=(i(21),i(22));t.exports=function(t){function e(i){return this instanceof e?(i=i||{},this.gravity=i.gravity||t.create(),this.friction=n(i.friction,.98),this.min=i.min,this.max=i.max,void(this.bounce=n(i.bounce,1))):new e(i)}var i=o(t),r=t.create(),s=t.create(),a=t.create();return e.prototype.collision=function(t,e){i(t,e,this.min,this.max,this.bounce)},e.prototype.integratePoint=function(e,i){var n="number"==typeof e.mass?e.mass:1;if(0===n)return this.collision(e,a),void t.copy(e.acceleration,a);t.add(e.acceleration,e.acceleration,this.gravity),t.scale(e.acceleration,e.acceleration,n),t.sub(r,e.position,e.previous),t.scale(r,r,this.friction),this.collision(e,r),t.copy(e.previous,e.position);var o=i*i;t.scale(s,e.acceleration,.5*o),t.add(e.position,e.position,r),t.add(e.position,e.position,s),t.copy(e.acceleration,a)},e.prototype.integrate=function(t,e){for(var i=0;i<t.length;i++)this.integratePoint(t[i],e)},e}},function(t,e){t.exports=function(t,e){return"number"==typeof t?t:"number"==typeof e?e:0}},function(t,e){function i(t,e,i){return e<i?t<e?e:t>i?i:t:t<i?i:t>e?e:t}t.exports=i},function(t,e){t.exports=function(t){var e=t.fromValues(-(1/0),-(1/0),-(1/0)),i=t.fromValues(1/0,1/0,1/0),n=t.fromValues(1,1,1),o=t.create(),r=1e-6;return function(s,a,c,p,u){if(c||p){t.copy(o,n),c=c||e,p=p||i;var f=0,d=s.position.length,l=!1,v=s.radius||0;for(f=0;f<d;f++)"number"==typeof c[f]&&s.position[f]-v<c[f]&&(o[f]=-1,s.position[f]=c[f]+v,l=!0);for(f=0;f<d;f++)"number"==typeof p[f]&&s.position[f]+v>p[f]&&(o[f]=-1,s.position[f]=p[f]-v,l=!0);var h=t.sqrLen(a);if(l&&!(h<=r)){var y=Math.sqrt(h);0!==y&&t.scale(a,a,1/y),t.scale(o,o,y*u),t.multiply(a,a,o)}}}}},function(t,e,i){var n={create:i(11),add:i(12),dot:i(24),sub:i(14),scale:i(15),distance:i(25)};t.exports=i(26)(n)},function(t,e){function i(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}t.exports=i},function(t,e){function i(t,e){var i=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2];return Math.sqrt(i*i+n*n+o*o)}t.exports=i},function(t,e){t.exports=function(t){function e(e,i){if(!e||2!==e.length)throw new Error("two points must be specified for the constraint");if(!e[0].position||!e[1].position)throw new Error("must specify verlet-point or similar, with { position }");this.points=e,this.stiffness=1,i&&"number"==typeof i.stiffness&&(this.stiffness=i.stiffness),i&&"number"==typeof i.restingDistance?this.restingDistance=i.restingDistance:this.restingDistance=t.distance(this.points[0].position,this.points[1].position)}var i=t.create(),n=t.create();return e.prototype.solve=function(){var e=this.points[0],o=this.points[1],r=e.position,s=o.position,a="number"==typeof e.mass?e.mass:1,c="number"==typeof o.mass?o.mass:1;t.sub(i,r,s);var p,u,f=Math.sqrt(t.dot(i,i)),d=0===f?this.restingDistance:(this.restingDistance-f)/f;if(0==a&&0==c)p=0,u=0;else if(0==a&&c>0)p=0,u=this.stiffness;else if(a>0&&0==c)p=this.stiffness,u=0;else{var l=1/a,v=1/c;p=l/(l+v)*this.stiffness,u=this.stiffness-p}return t.scale(n,i,p*d),t.add(r,r,n),t.scale(n,i,u*d),t.sub(s,s,n),f},function(t,i,n){return new e(t,i,n)}}},function(t,e,i){var n={create:i(11),sub:i(14),copy:i(16)};t.exports=i(28)(n)},function(t,e){t.exports=function(t){function e(e){this.position=t.create(),this.previous=t.create(),this.acceleration=t.create(),this.mass=1,this.radius=0,e&&"number"==typeof e.mass&&(this.mass=e.mass),e&&"number"==typeof e.radius&&(this.radius=e.radius),e&&e.position&&t.copy(this.position,e.position),e&&(e.previous||e.position)&&t.copy(this.previous,e.previous||e.position),e&&e.acceleration&&t.copy(this.acceleration,e.acceleration)}return e.prototype.addForce=function(e){return t.sub(this.previous,this.previous,e),this},e.prototype.place=function(e){return t.copy(this.position,e),t.copy(this.previous,e),this},function(t){return new e(t)}}},function(t,e){function i(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t}t.exports=i}]);