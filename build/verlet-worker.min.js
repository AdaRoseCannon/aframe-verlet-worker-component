!function(t){function i(o){if(n[o])return n[o].exports;var e=n[o]={exports:{},id:o,loaded:!1};return t[o].call(e.exports,e,e.exports,i),e.loaded=!0,e.exports}var n={};return i.m=t,i.c=n,i.p="",i(0)}([function(t,i,n){"use strict";function o(t){if(Array.isArray(t)){for(var i=0,n=Array(t.length);i<t.length;i++)n[i]=t[i];return n}return Array.from(t)}function e(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function s(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.points=[],this.pointMap=new Map,this.constraints=[],this.constraintMap=new Map,this.addPoint=function(i){var n=new d(i),o=void 0,e=t.pointMap.values();for(n.id=a++,n.verletPoint.id=n.id;o=e.next(),!o.done&&(o=o.value);)(n.attraction||o.attraction&&n!==o)&&t.connect(n.verletPoint,o.verletPoint,{stiffness:(n.attraction||0)+(o.attraction||0),restingDistance:n.verletPoint.radius+o.verletPoint.radius,range:"contact"===n.attractionRange?n.verletPoint.radius+o.verletPoint.radius:n.attractionRange?Number(n.attractionRange):1/0});return t.points.push(n.verletPoint),t.pointMap.set(n.id,n),n},this.removePoint=function(i){t.pointMap.get(i).constraints.forEach(function(i){return t.removeConstraint(i)}),t.pointMap.delete(i),t.needsUpdate=!0},this.connect=function(i,n,o){o||(o={stiffness:.05,restingDistance:i.radius+n.radius});var e=new p([i,n],o);return e.range=o.range||1/0,e.id=a++,t.constraints.push(e),t.constraintMap.set(e.id,e),e.id},this.removeConstraint=function(i){t.constraintMap.delete(i),t.needsUpdate=!0};var n={gravity:i.gravity?[0,i.gravity,0]:void 0,friction:.99};i.boxSize&&(n.min=[-i.size.x/2,-i.size.y/2,-i.size.z/2],n.min=[i.size.x/2,i.size.y/2,i.size.z/2]),"number"==typeof i.floor&&i.floor!==-(1/0)&&(n.min=[null,i.floor,null],n.max=[null,null,null]),this.world=new c(n);var e=0;this.animate=function(){var t=Date.now();if(this.needsUpdate){var i,n;this.points.splice(0),(i=this.points).push.apply(i,o(Array.from(this.pointMap.values()).map(function(t){return t.verletPoint}))),this.constraints.splice(0),(n=this.constraints).push.apply(n,o(this.constraintMap.values())),this.needsUpdate=!1}if(!(t-e<3)){for(var s=Math.min(.064,(t-e)/1e3),r=0,a=this.constraints.length;r<a;r++){var c=this.constraints[r];c.range&&c.range!==1/0&&l.distance(c.points[0].position,c.points[1].position)>c.range||c.solve()}this.world.integrate(this.points,s*f),e=t}}}var r=function(){function t(t,i){var n=[],o=!0,e=!1,s=void 0;try{for(var r,a=t[Symbol.iterator]();!(o=(r=a.next()).done)&&(n.push(r.value),!i||n.length!==i);o=!0);}catch(t){e=!0,s=t}finally{try{!o&&a.return&&a.return()}finally{if(e)throw s}}return n}return function(i,n){if(Array.isArray(i))return i;if(Symbol.iterator in Object(i))return t(i,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();importScripts("https://cdn.polyfill.io/v2/polyfill.js?features=es6");var a=100,c=n(6),p=n(19),u=n(23),f=1,l={create:n(7),add:n(8),subtract:n(10),scale:n(11),distance:n(21),length:n(25)},d=function t(i){var n=i.position,o=void 0===n?{x:0,y:0,z:0}:n,s=i.radius,r=void 0===s?1:s,a=i.mass,c=void 0===a?1:a,p=i.attraction,f=void 0===p?0:p,l=i.attractionRange,d=void 0===l?1/0:l,v=i.velocity,h=void 0===v?{x:0,y:0,z:0}:v;e(this,t),this.initialRadius=r,this.initialMass=c,this.attraction=f,this.attractionRange=d,this.constraints=[],this.verletPoint=new u({position:[o.x,o.y,o.z],mass:c,radius:r,attraction:f}).addForce([h.x,h.y,h.z])},v=void 0;self.addEventListener("message",function(t){var i=[],n=t.data.map(function(t){var n=r(t,2),o=n[0],e=n[1],a=e;switch(a.action){case"init":return v=new s(a.options),{id:o};case"getPoints":var c=new Float32Array(a.byteData);v.animate();for(var p=0,u=0,f=v.points.length;u<f;u++){var l=v.points[u];l&&(c[p+0]=l.id,c[p+1]=l.position[0],c[p+2]=l.position[1],c[p+3]=l.position[2],p+=4)}return i.push(c.buffer),{id:o,byteData:c.buffer,length:v.points.length};case"noopPoints":return{id:o,byteData:a.byteData,length:v.points.length};case"connectPoints":var d=v.pointMap.get(a.options.id1),h=v.pointMap.get(a.options.id2),y=v.connect(d.verletPoint,h.verletPoint,a.options.constraintOptions);return d.constraints.push(y),h.constraints.push(y),{id:o,constraintId:y};case"removeConstraint":return v.removeConstraint(a.options.constraintId),{id:o};case"updateConstraint":var m=v.constraintMap.get(a.options.constraintId);return void 0!==a.options.stiffness&&(m.stiffness=a.options.stiffness),void 0!==a.options.restingDistance&&(m.restingDistance=a.options.restingDistance),{id:o};case"addPoint":return{id:o,point:v.addPoint(a.pointOptions),length:v.points.length};case"removePoint":return v.removePoint(a.options.id),{id:o};case"updatePoint":var g=a.pointOptions,x=v.pointMap.get(g.id);return void 0!==g.position&&x.verletPoint.place([g.position.x,g.position.y,g.position.z]),void 0!==g.velocity&&x.verletPoint.addForce([g.velocity.x,g.velocity.y,g.velocity.z]),void 0!==g.mass&&(x.verletPoint.mass=g.mass),void 0!==g.radius&&(x.verletPoint.radius=g.radius),{id:o};case"reset":return v.points.splice(0),v.pointMap=new Map,v.constraints.splice(0),v.constraintMap=new Map,{id:o};default:return{error:"Invalid Action: "+a.action,id:o}}});self.postMessage(n,i)}),self.postMessage({id:"handshake"})},,,,,,function(t,i,n){var o={create:n(7),add:n(8),multiply:n(9),sub:n(10),scale:n(11),copy:n(12),sqrLen:n(13),fromValues:n(14)};t.exports=n(15)(o)},function(t,i){function n(){var t=new Float32Array(3);return t[0]=0,t[1]=0,t[2]=0,t}t.exports=n},function(t,i){function n(t,i,n){return t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}t.exports=n},function(t,i){function n(t,i,n){return t[0]=i[0]*n[0],t[1]=i[1]*n[1],t[2]=i[2]*n[2],t}t.exports=n},function(t,i){function n(t,i,n){return t[0]=i[0]-n[0],t[1]=i[1]-n[1],t[2]=i[2]-n[2],t}t.exports=n},function(t,i){function n(t,i,n){return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t}t.exports=n},function(t,i){function n(t,i){return t[0]=i[0],t[1]=i[1],t[2]=i[2],t}t.exports=n},function(t,i){function n(t){var i=t[0],n=t[1],o=t[2];return i*i+n*n+o*o}t.exports=n},function(t,i){function n(t,i,n){var o=new Float32Array(3);return o[0]=t,o[1]=i,o[2]=n,o}t.exports=n},function(t,i,n){var o=n(16),e=(n(17),n(18));t.exports=function(t){function i(n){return this instanceof i?(n=n||{},this.gravity=n.gravity||t.create(),this.friction=o(n.friction,.98),this.min=n.min,this.max=n.max,void(this.bounce=o(n.bounce,1))):new i(n)}var n=e(t),s=t.create(),r=t.create(),a=t.create();return i.prototype.collision=function(t,i){n(t,i,this.min,this.max,this.bounce)},i.prototype.integratePoint=function(i,n){var o="number"==typeof i.mass?i.mass:1;if(0===o)return this.collision(i,a),void t.copy(i.acceleration,a);t.add(i.acceleration,i.acceleration,this.gravity),t.scale(i.acceleration,i.acceleration,o),t.sub(s,i.position,i.previous),t.scale(s,s,this.friction),this.collision(i,s),t.copy(i.previous,i.position);var e=n*n;t.scale(r,i.acceleration,.5*e),t.add(i.position,i.position,s),t.add(i.position,i.position,r),t.copy(i.acceleration,a)},i.prototype.integrate=function(t,i){for(var n=0;n<t.length;n++)this.integratePoint(t[n],i)},i}},function(t,i){t.exports=function(t,i){return"number"==typeof t?t:"number"==typeof i?i:0}},function(t,i){function n(t,i,n){return i<n?t<i?i:t>n?n:t:t<n?n:t>i?i:t}t.exports=n},function(t,i){t.exports=function(t){var i=t.fromValues(-(1/0),-(1/0),-(1/0)),n=t.fromValues(1/0,1/0,1/0),o=t.fromValues(1,1,1),e=t.create(),s=1e-6;return function(r,a,c,p,u){if(c||p){t.copy(e,o),c=c||i,p=p||n;var f=0,l=r.position.length,d=!1,v=r.radius||0;for(f=0;f<l;f++)"number"==typeof c[f]&&r.position[f]-v<c[f]&&(e[f]=-1,r.position[f]=c[f]+v,d=!0);for(f=0;f<l;f++)"number"==typeof p[f]&&r.position[f]+v>p[f]&&(e[f]=-1,r.position[f]=p[f]-v,d=!0);var h=t.sqrLen(a);if(d&&!(h<=s)){var y=Math.sqrt(h);0!==y&&t.scale(a,a,1/y),t.scale(e,e,y*u),t.multiply(a,a,e)}}}}},function(t,i,n){var o={create:n(7),add:n(8),dot:n(20),sub:n(10),scale:n(11),distance:n(21)};t.exports=n(22)(o)},function(t,i){function n(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]}t.exports=n},function(t,i){function n(t,i){var n=i[0]-t[0],o=i[1]-t[1],e=i[2]-t[2];return Math.sqrt(n*n+o*o+e*e)}t.exports=n},function(t,i){t.exports=function(t){function i(i,n){if(!i||2!==i.length)throw new Error("two points must be specified for the constraint");if(!i[0].position||!i[1].position)throw new Error("must specify verlet-point or similar, with { position }");this.points=i,this.stiffness=1,n&&"number"==typeof n.stiffness&&(this.stiffness=n.stiffness),n&&"number"==typeof n.restingDistance?this.restingDistance=n.restingDistance:this.restingDistance=t.distance(this.points[0].position,this.points[1].position)}var n=t.create(),o=t.create();return i.prototype.solve=function(){var i=this.points[0],e=this.points[1],s=i.position,r=e.position,a="number"==typeof i.mass?i.mass:1,c="number"==typeof e.mass?e.mass:1;t.sub(n,s,r);var p,u,f=Math.sqrt(t.dot(n,n)),l=0===f?this.restingDistance:(this.restingDistance-f)/f;if(0==a&&0==c)p=0,u=0;else if(0==a&&c>0)p=0,u=this.stiffness;else if(a>0&&0==c)p=this.stiffness,u=0;else{var d=1/a,v=1/c;p=d/(d+v)*this.stiffness,u=this.stiffness-p}return t.scale(o,n,p*l),t.add(s,s,o),t.scale(o,n,u*l),t.sub(r,r,o),f},function(t,n,o){return new i(t,n,o)}}},function(t,i,n){var o={create:n(7),sub:n(10),copy:n(12)};t.exports=n(24)(o)},function(t,i){t.exports=function(t){function i(i){this.position=t.create(),this.previous=t.create(),this.acceleration=t.create(),this.mass=1,this.radius=0,i&&"number"==typeof i.mass&&(this.mass=i.mass),i&&"number"==typeof i.radius&&(this.radius=i.radius),i&&i.position&&t.copy(this.position,i.position),i&&(i.previous||i.position)&&t.copy(this.previous,i.previous||i.position),i&&i.acceleration&&t.copy(this.acceleration,i.acceleration)}return i.prototype.addForce=function(i){return t.sub(this.previous,this.previous,i),this},i.prototype.place=function(i){return t.copy(this.position,i),t.copy(this.previous,i),this},function(t){return new i(t)}}},function(t,i){function n(t){var i=t[0],n=t[1],o=t[2];return Math.sqrt(i*i+n*n+o*o)}t.exports=n}]);