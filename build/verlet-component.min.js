!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function r(o,i){try{var a=e[o](i),s=a.value}catch(t){return void n(t)}return a.done?void t(s):Promise.resolve(s).then(function(t){r("next",t)},function(t){r("throw",t)})}return r("next")})}}var a=n(1),s=r(a),u=function(){var t=i(s.default.mark(function t(e){var n;return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new c,t.next=3,n.init(e);case 3:return t.abrupt("return",n);case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),c=n(5);AFRAME.registerComponent("verlet-container",{schema:{gravity:{default:-9.8},boxSize:{default:0},floor:{default:-(1/0)}},init:function(){var t=this;this.systemPromise=u(this.data).then(function(e){return t.v=e}),this.systemPromise.then(function(e){return t.el.emit("verlet-container-init-complete",e)}),this.points=new Map,this.updatePoints=this.updatePoints.bind(this)},update:function(){},addPoint:function(t,e){var n=this;return this.systemPromise.then(function(t){return t.addPoint(e)}).then(function(e){return n.points.set(e.point.id,t),e.point.id})},removePoint:function(t){return this.systemPromise.then(function(e){return e.removePoint(t)})},updatePoint:function(t,e){var n={id:t};return Object.assign(n,e),this.systemPromise.then(function(t){return t.updatePoint(n)})},connectPoints:function(t,e,n){return this.systemPromise.then(function(r){return r.connectPoints(t,e,n)})},removeConstraint:function(t){return this.systemPromise.then(function(e){return e.removeConstraint(t)})},tick:function(){this.v&&(this.v.getPoints().then(this.updatePoints),this.v.process())},updatePoints:function(t){for(var e=t.byteData,n=0,r=e.length;n<r;n+=4){var o=e[n+0]&&this.points.get(e[n+0]);if(o){var i=e[n+1],a=e[n+2],s=e[n+3];o.setPosition(i,a,s)}}}}),AFRAME.registerComponent("verlet-constraint",{schema:{stiffness:{default:.05},from:{type:"selectorAll"},to:{type:"selectorAll"},distance:{default:""}},init:function(){for(var t=this.el;t&&t.matches&&!t.matches("[verlet-container]");)t=t.parentNode;t.components["verlet-container"]?this.parentReadyPromise=Promise.resolve(t.components["verlet-container"]):this.parentReadyPromise=new Promise(function(e){return t.addEventListener("verlet-container-init-complete",function(){return e(t.components["verlet-container"])})}),this.constraints=new Map},update:function(){var t=this;this.remove().then(function(){t.idPromises=t.idPromises||[],t.data.restingDistance=t.data.distance?Number(t.data.distance):void 0,t.parentReadyPromise.then(function(e){t.data.from&&t.data.from.length||(t.el.matches("[verlet-point]")?t.data.from=[t.el]:t.data.from=[]),t.data.to&&t.data.to.length||(t.el.matches("[verlet-point]")?t.data.to=[t.el]:t.data.to=[]);var n=!0,r=!1,o=void 0;try{for(var i,a=t.data.to[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value,u=!0,c=!1,f=void 0;try{for(var l,h=t.data.from[Symbol.iterator]();!(u=(l=h.next()).done);u=!0){var p=l.value;s!==p&&(s.components["verlet-point"].idPromise||s.updateComponent("verlet-point"),p.components["verlet-point"].idPromise||p.updateComponent("verlet-point"),t.idPromises.push(Promise.all([s.components["verlet-point"].idPromise,p.components["verlet-point"].idPromise]).then(function(n){var r=n[0],o=n[1];return e.connectPoints(r,o,{stiffness:t.data.stiffness,restingDistance:t.data.restingDistance}).then(function(t){return t.constraintId})})))}}catch(t){c=!0,f=t}finally{try{!u&&h.return&&h.return()}finally{if(c)throw f}}}}catch(t){r=!0,o=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}})})},remove:function(){return this.idPromises?Promise.all([this.parentReadyPromise].concat(o(this.idPromises))).then(function(t){var e=t.shift();return Promise.all(t.map(function(t){return e.removeConstraint(t)}))}):Promise.resolve()}}),AFRAME.registerComponent("verlet-point",{schema:{position:{type:"vec3"},velocity:{type:"vec3"},mass:{default:1},radius:{default:0}},init:function(){for(var t=this,e=this.el;e&&e.matches&&!e.matches("[verlet-container]");)e=e.parentNode;e.components["verlet-container"]?this.parentReadyPromise=Promise.resolve(e.components["verlet-container"]):this.parentReadyPromise=new Promise(function(t){return e.addEventListener("verlet-container-init-complete",function(){return t(e.components["verlet-container"])})}),this.parentReadyPromise.then(function(e){t.parentVerletComponent=e}),this.el.updateComponent("position")},setPosition:function(t,e,n){this.el.object3D.position.x=t,this.el.object3D.position.y=e,this.el.object3D.position.z=n},update:function(){var t=this;return this.parentReadyPromise.then(function(e){return t.data.position=t.attrValue.position?t.data.position:t.el.object3D.position,t.idPromise?t.idPromise.then(function(n){return e.updatePoint(n,t.data)}):(t.idPromise=e.addPoint(t,t.data),t.idPromise)})},remove:function(){var t=this;return this.parentReadyPromise.then(function(e){return t.idPromise?t.idPromise.then(function(t){return e.removePoint(t)}):Promise.resolve()})}}),AFRAME.registerPrimitive("a-verlet-constraint",{defaultComponents:{"verlet-constraint":{}},mappings:{to:"verlet-constraint.to",from:"verlet-constraint.from",stiffness:"verlet-constraint.stiffness",distance:"verlet-constraint.distance"}})},function(t,e,n){t.exports=n(2)},function(t,e,n){(function(e){var r="object"==typeof e?e:"object"==typeof window?window:"object"==typeof self?self:this,o=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,i=o&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,t.exports=n(3),o)r.regeneratorRuntime=i;else try{delete r.regeneratorRuntime}catch(t){r.regeneratorRuntime=void 0}}).call(e,function(){return this}())},function(t,e,n){(function(e,n){!function(e){"use strict";function r(t,e,n,r){var o=e&&e.prototype instanceof i?e:i,a=Object.create(o.prototype),s=new p(r||[]);return a._invoke=f(t,n,s),a}function o(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function i(){}function a(){}function s(){}function u(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function c(t){function e(n,r,i,a){var s=o(t[n],t,r);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&g.call(c,"__await")?Promise.resolve(c.__await).then(function(t){e("next",t,i,a)},function(t){e("throw",t,i,a)}):Promise.resolve(c).then(function(t){u.value=t,i(u)},a)}a(s.arg)}function r(t,n){function r(){return new Promise(function(r,o){e(t,n,r,o)})}return i=i?i.then(r,r):r()}"object"==typeof n&&n.domain&&(e=n.domain.bind(e));var i;this._invoke=r}function f(t,e,n){var r=E;return function(i,a){if(r===L)throw new Error("Generator is already running");if(r===T){if("throw"===i)throw a;return v()}for(;;){var s=n.delegate;if(s){if("return"===i||"throw"===i&&s.iterator[i]===m){n.delegate=null;var u=s.iterator.return;if(u){var c=o(u,s.iterator,a);if("throw"===c.type){i="throw",a=c.arg;continue}}if("return"===i)continue}var c=o(s.iterator[i],s.iterator,a);if("throw"===c.type){n.delegate=null,i="throw",a=c.arg;continue}i="next",a=m;var f=c.arg;if(!f.done)return r=A,f;n[s.resultName]=f.value,n.next=s.nextLoc,n.delegate=null}if("next"===i)n.sent=n._sent=a;else if("throw"===i){if(r===E)throw r=T,a;n.dispatchException(a)&&(i="next",a=m)}else"return"===i&&n.abrupt("return",a);r=L;var c=o(t,e,n);if("normal"===c.type){r=n.done?T:A;var f={value:c.arg,done:n.done};if(c.arg!==_)return f;n.delegate&&"next"===i&&(a=m)}else"throw"===c.type&&(r=T,i="throw",a=c.arg)}}}function l(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function h(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(l,this),this.reset(!0)}function d(t){if(t){var e=t[P];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(g.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=m,e.done=!0,e};return r.next=r}}return{next:v}}function v(){return{value:m,done:!0}}var m,y=Object.prototype,g=y.hasOwnProperty,w="function"==typeof Symbol?Symbol:{},P=w.iterator||"@@iterator",b=w.toStringTag||"@@toStringTag",x="object"==typeof t,k=e.regeneratorRuntime;if(k)return void(x&&(t.exports=k));k=e.regeneratorRuntime=x?t.exports:{},k.wrap=r;var E="suspendedStart",A="suspendedYield",L="executing",T="completed",_={},j={};j[P]=function(){return this};var R=Object.getPrototypeOf,M=R&&R(R(d([])));M&&M!==y&&g.call(M,P)&&(j=M);var D=s.prototype=i.prototype=Object.create(j);a.prototype=D.constructor=s,s.constructor=a,s[b]=a.displayName="GeneratorFunction",k.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===a||"GeneratorFunction"===(e.displayName||e.name))},k.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,b in t||(t[b]="GeneratorFunction")),t.prototype=Object.create(D),t},k.awrap=function(t){return{__await:t}},u(c.prototype),k.AsyncIterator=c,k.async=function(t,e,n,o){var i=new c(r(t,e,n,o));return k.isGeneratorFunction(e)?i:i.next().then(function(t){return t.done?t.value:i.next()})},u(D),D[b]="Generator",D.toString=function(){return"[object Generator]"},k.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},k.values=d,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.tryEntries.forEach(h),!t)for(var e in this)"t"===e.charAt(0)&&g.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=m)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){function e(e,r){return i.type="throw",i.arg=t,n.next=e,!!r}if(this.done)throw t;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=g.call(o,"catchLoc"),s=g.call(o,"finallyLoc");if(a&&s){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&g.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?this.next=o.finallyLoc:this.complete(i),_},complete:function(t,e){if("throw"===t.type)throw t.arg;"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=t.arg,this.next="end"):"normal"===t.type&&e&&(this.next=e)},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),h(n),_}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;h(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:d(t),resultName:e,nextLoc:n},_}}}("object"==typeof e?e:"object"==typeof window?window:"object"==typeof self?self:this)}).call(e,function(){return this}(),n(4))},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(f===setTimeout)return setTimeout(t,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(t,0);try{return f(t,0)}catch(e){try{return f.call(null,t,0)}catch(e){return f.call(this,t,0)}}}function i(t){if(l===clearTimeout)return clearTimeout(t);if((l===r||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function a(){v&&p&&(v=!1,p.length?d=p.concat(d):m=-1,d.length&&s())}function s(){if(!v){var t=o(a);v=!0;for(var e=d.length;e;){for(p=d,d=[];++m<e;)p&&p[m].run();m=-1,e=d.length}p=null,v=!1,i(t)}}function u(t,e){this.fun=t,this.array=e}function c(){}var f,l,h=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(t){f=n}try{l="function"==typeof clearTimeout?clearTimeout:r}catch(t){l=r}}();var p,d=[],v=!1,m=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];d.push(new u(t,e)),1!==d.length||v||o(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=c,h.addListener=c,h.once=c,h.off=c,h.removeListener=c,h.removeAllListeners=c,h.emit=c,h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t){var e=this,n=t.data;return"handshake"===n.id?void this.workerPromiseResolver():void n.forEach(function(t){var n=i.get(t.id);i.delete(t.id),delete t.id,t.error?n.reject(t.error):(t.byteData&&(e.dataAvailable=!0,e.data=new Float32Array(t.byteData),t.byteData=e.data),n.resolve(t))})}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=new Map,a="BYTE_DATA_STAND_IN",s=function(){function t(){var e=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;n(this,t),this.myWorker=new Worker("./build/worker.js"),this.workerPromise=new Promise(function(t){return e.workerPromiseResolver=t}),this.myWorker.addEventListener("message",r.bind(this)),this.messageQueue=[],this.setMaxPoints(o),this.process=this.process.bind(this)}return o(t,[{key:"setMaxPoints",value:function(t){this.maxPoints=t,this.data=new Float32Array(4*t),this.dataAvailable=!0}},{key:"process",value:function(){if(this.data&&this.messageQueue.length){var t=[],e={},n=this.messageQueue.splice(0),r=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var c=s.value;c.message.BYTE_DATA_STAND_IN&&(delete c.message.BYTE_DATA_STAND_IN,c.message.byteData=this.data.buffer,t.indexOf(this.data.buffer)===-1&&t.push(this.data.buffer)),e[c.id]=c.message,i.set(c.id,c)}}catch(t){o=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}t.indexOf(this.data.buffer)!==-1&&(this.dataAvailable=!1,this.data=void 0),this.myWorker.postMessage(e,t)}}},{key:"workerMessage",value:function(t){var e=String(Date.now()+Math.floor(1e6*Math.random()));return new Promise(function(n,r){var o={id:e,message:t,resolve:n,reject:r};if("getPoints"===t.action){var i=!0,a=!1,s=void 0;try{for(var u,c=this.messageQueue[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){var f=u.value;"getPoints"===f.message.action&&(f.message.action="noopPoints")}}catch(t){a=!0,s=t}finally{try{!i&&c.return&&c.return()}finally{if(a)throw s}}}this.messageQueue.push(o)}.bind(this))}},{key:"init",value:function(t){var e=this;return this.workerPromise.then(function(){var n=e.workerMessage({action:"init",options:t});return e.process(),n})}},{key:"getPoints",value:function(){return this.workerMessage({action:"getPoints",BYTE_DATA_STAND_IN:a})}},{key:"addPoint",value:function(t){return this.workerMessage({action:"addPoint",pointOptions:t})}},{key:"updatePoint",value:function(t){return this.workerMessage({action:"updatePoint",pointOptions:t})}},{key:"removePoint",value:function(t){return this.workerMessage({action:"removePoint",options:{id:t}})}},{key:"connectPoints",value:function(t,e,n){return this.workerMessage({action:"connectPoints",options:{id1:t,id2:e,constraintOptions:n}})}},{key:"updateConstraint",value:function(t){return this.workerMessage({action:"updateConstraint",options:t})}},{key:"removeConstraint",value:function(t){return this.workerMessage({action:"removeConstraint",options:{constraintId:t}})}},{key:"reset",value:function(){return this.workerMessage({action:"reset"})}}]),t}();t.exports=s}]);