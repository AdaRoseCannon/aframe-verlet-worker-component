!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";n(1),n(7),n(8),n(9)},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function r(o,i){try{var a=e[o](i),s=a.value}catch(t){return void n(t)}return a.done?void t(s):Promise.resolve(s).then(function(t){r("next",t)},function(t){r("throw",t)})}return r("next")})}}var i=n(2),a=r(i),s=function(){var t=o(a.default.mark(function t(e){var n;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.workerUrl?new c(e.workerUrl):new c,t.next=3,n.init(e);case 3:return t.abrupt("return",n);case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),c=n(6);AFRAME.registerComponent("verlet-container",{schema:{gravity:{default:-9.8},boxSize:{default:0},floor:{default:-(1/0)},workerUrl:{default:""},friction:{default:.99}},init:function(){var t=this;this.systemPromise=s(this.data).then(function(e){return t.v=e}),this.systemPromise.then(function(e){return t.el.emit("verlet-container-init-complete",e)}),this.points=new Map,this.updatePoints=this.updatePoints.bind(this)},update:function(){},addPoint:function(t,e){var n=this;return this.systemPromise.then(function(t){return t.addPoint(e)}).then(function(e){return n.points.set(e.point.id,t),e.point.id})},removePoint:function(t){return this.systemPromise.then(function(e){return e.removePoint(t)})},updatePoint:function(t,e){var n={id:t};return Object.assign(n,e),this.systemPromise.then(function(t){return t.updatePoint(n)})},connectPoints:function(t,e,n){return"number"==typeof n.restingDistance&&NaN!==n.restingDistance||console.warn("Invalid Contstraint",t,e,n),t.components["verlet-point"].idPromise||t.updateComponent("verlet-point"),e.components["verlet-point"].idPromise||e.updateComponent("verlet-point"),Promise.all([t.components["verlet-point"].idPromise,e.components["verlet-point"].idPromise,this.systemPromise]).then(function(t){var e=t[0],r=t[1],o=t[2];return o.connectPoints(e,r,n)})},removeConstraint:function(t){return this.systemPromise.then(function(e){return e.removeConstraint(t)})},createForce:function(t,e){return this.systemPromise.then(function(n){return n.createForce(t,e)}).then(function(t){return t.forceId})},updateForce:function(t,e){return this.systemPromise.then(function(n){return n.updateForce(t,e)})},tick:function(){this.v&&(this.v.getPoints().then(this.updatePoints),this.v.process())},updatePoints:function(t){for(var e=t.byteData,n=t.length,r=0,o=n;r<o;r+=1){var i=e[4*r+0]&&this.points.get(e[4*r+0]);if(i){var a=e[4*r+1],s=e[4*r+2],c=e[4*r+3];i.setPosition(a,s,c)}}}})},function(t,e,n){t.exports=n(3)},function(t,e,n){(function(e){var r="object"==typeof e?e:"object"==typeof window?window:"object"==typeof self?self:this,o=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,i=o&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,t.exports=n(4),o)r.regeneratorRuntime=i;else try{delete r.regeneratorRuntime}catch(t){r.regeneratorRuntime=void 0}}).call(e,function(){return this}())},function(t,e,n){(function(e,n){!function(e){"use strict";function r(t,e,n,r){var o=e&&e.prototype instanceof i?e:i,a=Object.create(o.prototype),s=new d(r||[]);return a._invoke=l(t,n,s),a}function o(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function i(){}function a(){}function s(){}function c(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function u(t){function e(n,r,i,a){var s=o(t[n],t,r);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==typeof u&&g.call(u,"__await")?Promise.resolve(u.__await).then(function(t){e("next",t,i,a)},function(t){e("throw",t,i,a)}):Promise.resolve(u).then(function(t){c.value=t,i(c)},a)}a(s.arg)}function r(t,n){function r(){return new Promise(function(r,o){e(t,n,r,o)})}return i=i?i.then(r,r):r()}"object"==typeof n&&n.domain&&(e=n.domain.bind(e));var i;this._invoke=r}function l(t,e,n){var r=E;return function(i,a){if(r===R)throw new Error("Generator is already running");if(r===L){if("throw"===i)throw a;return v()}for(;;){var s=n.delegate;if(s){if("return"===i||"throw"===i&&s.iterator[i]===m){n.delegate=null;var c=s.iterator.return;if(c){var u=o(c,s.iterator,a);if("throw"===u.type){i="throw",a=u.arg;continue}}if("return"===i)continue}var u=o(s.iterator[i],s.iterator,a);if("throw"===u.type){n.delegate=null,i="throw",a=u.arg;continue}i="next",a=m;var l=u.arg;if(!l.done)return r=A,l;n[s.resultName]=l.value,n.next=s.nextLoc,n.delegate=null}if("next"===i)n.sent=n._sent=a;else if("throw"===i){if(r===E)throw r=L,a;n.dispatchException(a)&&(i="next",a=m)}else"return"===i&&n.abrupt("return",a);r=R;var u=o(t,e,n);if("normal"===u.type){r=n.done?L:A;var l={value:u.arg,done:n.done};if(u.arg!==T)return l;n.delegate&&"next"===i&&(a=m)}else"throw"===u.type&&(r=L,i="throw",a=u.arg)}}}function f(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function h(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function d(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(f,this),this.reset(!0)}function p(t){if(t){var e=t[w];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(g.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=m,e.done=!0,e};return r.next=r}}return{next:v}}function v(){return{value:m,done:!0}}var m,y=Object.prototype,g=y.hasOwnProperty,P="function"==typeof Symbol?Symbol:{},w=P.iterator||"@@iterator",b=P.toStringTag||"@@toStringTag",k="object"==typeof t,x=e.regeneratorRuntime;if(x)return void(k&&(t.exports=x));x=e.regeneratorRuntime=k?t.exports:{},x.wrap=r;var E="suspendedStart",A="suspendedYield",R="executing",L="completed",T={},j={};j[w]=function(){return this};var D=Object.getPrototypeOf,M=D&&D(D(p([])));M&&M!==y&&g.call(M,w)&&(j=M);var _=s.prototype=i.prototype=Object.create(j);a.prototype=_.constructor=s,s.constructor=a,s[b]=a.displayName="GeneratorFunction",x.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===a||"GeneratorFunction"===(e.displayName||e.name))},x.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,b in t||(t[b]="GeneratorFunction")),t.prototype=Object.create(_),t},x.awrap=function(t){return{__await:t}},c(u.prototype),x.AsyncIterator=u,x.async=function(t,e,n,o){var i=new u(r(t,e,n,o));return x.isGeneratorFunction(e)?i:i.next().then(function(t){return t.done?t.value:i.next()})},c(_),_[b]="Generator",_.toString=function(){return"[object Generator]"},x.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},x.values=p,d.prototype={constructor:d,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.tryEntries.forEach(h),!t)for(var e in this)"t"===e.charAt(0)&&g.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=m)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){function e(e,r){return i.type="throw",i.arg=t,n.next=e,!!r}if(this.done)throw t;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=g.call(o,"catchLoc"),s=g.call(o,"finallyLoc");if(a&&s){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&g.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?this.next=o.finallyLoc:this.complete(i),T},complete:function(t,e){if("throw"===t.type)throw t.arg;"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=t.arg,this.next="end"):"normal"===t.type&&e&&(this.next=e)},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),h(n),T}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;h(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:p(t),resultName:e,nextLoc:n},T}}}("object"==typeof e?e:"object"==typeof window?window:"object"==typeof self?self:this)}).call(e,function(){return this}(),n(5))},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(l===setTimeout)return setTimeout(t,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function i(t){if(f===clearTimeout)return clearTimeout(t);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(t);try{return f(t)}catch(e){try{return f.call(null,t)}catch(e){return f.call(this,t)}}}function a(){v&&d&&(v=!1,d.length?p=d.concat(p):m=-1,p.length&&s())}function s(){if(!v){var t=o(a);v=!0;for(var e=p.length;e;){for(d=p,p=[];++m<e;)d&&d[m].run();m=-1,e=p.length}d=null,v=!1,i(t)}}function c(t,e){this.fun=t,this.array=e}function u(){}var l,f,h=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(t){l=n}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(t){f=r}}();var d,p=[],v=!1,m=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new c(t,e)),1!==p.length||v||o(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=u,h.addListener=u,h.once=u,h.off=u,h.removeListener=u,h.removeAllListeners=u,h.emit=u,h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t){var e=this,n=t.data;return"handshake"===n.id?void this.workerPromiseResolver():void n.forEach(function(t){var n=i.get(t.id);i.delete(t.id),delete t.id,t.error?n.reject(t.error):(t.byteData&&(e.dataAvailable=!0,e.data=new Float32Array(t.byteData),t.byteData=e.data),n.resolve(t))})}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=new Map,a="BYTE_DATA_STAND_IN",s=document.currentScript||function(){var t=document.getElementsByTagName("script");return t[t.length-1]}(),c=s&&s.src&&s.src.replace(/[^\/]+.js$/,"verlet-worker.js")||"https://rawgit.com/AdaRoseEdwards/aframe-verlet-worker-component/master/build/verlet-worker.js",u=function(){function t(){var e=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;n(this,t),this.myWorker=new Worker(o),this.workerPromise=new Promise(function(t){return e.workerPromiseResolver=t}),this.myWorker.addEventListener("message",r.bind(this)),this.messageQueue=[],this.setMaxPoints(i),this.process=this.process.bind(this)}return o(t,[{key:"setMaxPoints",value:function(t){this.maxPoints=t,this.data=new Float32Array(4*t),this.dataAvailable=!0}},{key:"process",value:function(){if(this.data&&this.messageQueue.length){var t=[],e=[],n=this.messageQueue.splice(0),r=!0,o=!1,a=void 0;try{for(var s,c=n[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var u=s.value;u.message.BYTE_DATA_STAND_IN&&(delete u.message.BYTE_DATA_STAND_IN,u.message.byteData=this.data.buffer,t.indexOf(this.data.buffer)===-1&&t.push(this.data.buffer)),e.push([u.id,u.message]),i.set(u.id,u)}}catch(t){o=!0,a=t}finally{try{!r&&c.return&&c.return()}finally{if(o)throw a}}t.indexOf(this.data.buffer)!==-1&&(this.dataAvailable=!1,this.data=void 0),this.myWorker.postMessage(e,t)}}},{key:"workerMessage",value:function(t){var e=String(Date.now()+Math.floor(1e6*Math.random()));return new Promise(function(n,r){var o={id:e,message:t,resolve:n,reject:r};if("getPoints"===t.action){var i=!0,a=!1,s=void 0;try{for(var c,u=this.messageQueue[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var l=c.value;"getPoints"===l.message.action&&(l.message.action="noopPoints")}}catch(t){a=!0,s=t}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}}this.messageQueue.push(o)}.bind(this))}},{key:"init",value:function(t){var e=this;return this.workerPromise.then(function(){var n=e.workerMessage({action:"init",options:t});return e.process(),n})}},{key:"getPoints",value:function(){return this.workerMessage({action:"getPoints",BYTE_DATA_STAND_IN:a})}},{key:"addPoint",value:function(t){var e=this;return this.workerMessage({action:"addPoint",pointOptions:t}).then(function(t){return t.length>.9*e.maxPoints&&(e.setMaxPoints(2*e.maxPoints),console.log("Updated the memory space for the verlet points to hold "+e.maxPoints+" points.")),t})}},{key:"createForce",value:function(t,e){return this.workerMessage({action:"createForce",forceOptions:t,targets:e})}},{key:"useForce",value:function(t,e){return this.workerMessage({action:"useForce",forceId:t,targets:e})}},{key:"updateForce",value:function(t,e){return this.workerMessage({action:"updateForce",forceOptions:e,forceId:t})}},{key:"updatePoint",value:function(t){return this.workerMessage({action:"updatePoint",pointOptions:t})}},{key:"removePoint",value:function(t){return this.workerMessage({action:"removePoint",options:{id:t}})}},{key:"connectPoints",value:function(t,e,n){return this.workerMessage({action:"connectPoints",options:{id1:t,id2:e,constraintOptions:n}})}},{key:"updateConstraint",value:function(t){return this.workerMessage({action:"updateConstraint",options:t})}},{key:"removeConstraint",value:function(t){return this.workerMessage({action:"removeConstraint",options:{constraintId:t}})}},{key:"reset",value:function(){return this.workerMessage({action:"reset"})}}]),t}();t.exports=u},function(t,e){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}AFRAME.registerComponent("verlet-constraint",{schema:{stiffness:{default:.05},from:{type:"selectorAll"},to:{type:"selectorAll"},distance:{default:0},breakingDistance:{default:""},range:{default:1/0}},init:function(){for(var t=this.el;t&&t.matches&&!t.matches("[verlet-container], verlet-ui");)t=t.parentNode;t.components["verlet-container"]?this.parentReadyPromise=Promise.resolve(t.components["verlet-container"]):this.parentReadyPromise=new Promise(function(e){return t.addEventListener("verlet-container-init-complete",function(){return e(t.components["verlet-container"])})}),this.constraints=new Map},update:function(){var t=this;this.remove().then(function(){t.idPromises=t.idPromises||[],t.data.breakingDistance=t.data.breakingDistance?Number(t.data.breakingDistance):void 0,t.parentReadyPromise.then(function(e){t.data.from&&t.data.from.length||(t.el.matches("[verlet-point]")?t.data.from=[t.el]:t.data.from=[]),t.data.to&&t.data.to.length||(t.el.matches("[verlet-point]")?t.data.to=[t.el]:t.data.to=[]);var n=!0,r=!1,o=void 0;try{for(var i,a=t.data.to[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value,c=!0,u=!1,l=void 0;try{for(var f,h=t.data.from[Symbol.iterator]();!(c=(f=h.next()).done);c=!0){var d=f.value;s!==d&&t.idPromises.push(e.connectPoints(s,d,{stiffness:t.data.stiffness,restingDistance:t.data.distance,range:t.data.range,breakingDistance:t.data.breakingDistance}).then(function(t){return t.constraintId}))}}catch(t){u=!0,l=t}finally{try{!c&&h.return&&h.return()}finally{if(u)throw l}}}}catch(t){r=!0,o=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}})})},remove:function(){return this.idPromises?Promise.all([this.parentReadyPromise].concat(n(this.idPromises))).then(function(t){var e=t.shift();return Promise.all(t.map(function(t){return e.removeConstraint(t)}))}):Promise.resolve()}}),AFRAME.registerPrimitive("a-verlet-constraint",{defaultComponents:{"verlet-constraint":{}},mappings:{to:"verlet-constraint.to",from:"verlet-constraint.from",stiffness:"verlet-constraint.stiffness",distance:"verlet-constraint.distance",range:"verlet-constraint.range"}})},function(t,e){"use strict";AFRAME.registerComponent("verlet-force",{schema:{vector:{type:"vec3"},target:{type:"selectorAll"}},init:function(){for(var t=this.el;t&&t.matches&&!t.matches("[verlet-container], verlet-ui");)t=t.parentNode;t.components["verlet-container"]?this.parentReadyPromise=Promise.resolve(t.components["verlet-container"]):this.parentReadyPromise=new Promise(function(e){return t.addEventListener("verlet-container-init-complete",function(){return e(t.components["verlet-container"])})}),this.hasRequestedCreation=!1},update:function(){var t=this,e=this.parentReadyPromise.then(function(e){if(t.data.target=t.attrValue.target?t.data.target:[t.el],t.hasRequestedCreation===!1){t.hasRequestedCreation=!0;var n=t.data.target.map(function(t){if(t.components["verlet-container"])return Promise.resolve("world");if(!t.components["verlet-point"])throw Error("Target is not a verlet-point or verlet-container");return t.components["verlet-point"].idPromise||t.updateComponent("verlet-point"),t.components["verlet-point"].idPromise});return Promise.all(n).then(function(n){return e.createForce({vector:t.data.vector},n)})}return t.idPromise.then(function(n){return e.updateForce(n,{vector:t.data.vector})})});return this.idPromise||(this.idPromise=e),this.idPromise},remove:function(){}})},function(t,e){"use strict";AFRAME.registerComponent("verlet-point",{schema:{position:{type:"vec3"},velocity:{type:"vec3"},mass:{default:1},radius:{default:0},attraction:{default:0},attractionRange:{default:"contact"},syncPosition:{default:!1}},init:function(){for(var t=this,e=this.el;e&&e.matches&&!e.matches("[verlet-container], verlet-ui");)e=e.parentNode;e.components["verlet-container"]?this.parentReadyPromise=Promise.resolve(e.components["verlet-container"]):this.parentReadyPromise=new Promise(function(t){return e.addEventListener("verlet-container-init-complete",function(){return t(e.components["verlet-container"])})}),this.parentReadyPromise.then(function(e){t.parentVerletComponent=e}),this.hasRequestedPoint=!1,this.parentVerletElement=e},setPosition:function(t,e,n){this.data.syncPosition||(this.el.object3D.position.x=t,this.el.object3D.position.y=e,this.el.object3D.position.z=n)},update:function(){var t=this;if(this.data.syncPosition&&0!==this.data.mass)throw Error("Can only sync position if the mass is 0");var e=this.parentReadyPromise.then(function(e){return t.data.position=t.attrValue.position?t.data.position:t.parentVerletElement.object3D.worldToLocal(t.el.object3D.getWorldPosition()),t.hasRequestedPoint?t.idPromise.then(function(n){return e.updatePoint(n,t.data),n}):(t.hasRequestedPoint=!0,e.addPoint(t,t.data).then(function(e){return t.id=e}))});return this.idPromise||(this.idPromise=e),this.idPromise},tick:function(){this.data.syncPosition&&this.parentVerletComponent&&this.id&&(this.worldPosition||(this.worldPosition=new AFRAME.THREE.Vector3),this.parentVerletComponent.updatePoint(this.id,{position:this.parentVerletElement.object3D.worldToLocal(this.el.object3D.getWorldPosition(this.worldPosition))}))},remove:function(){var t=this;return this.id=void 0,this.parentReadyPromise.then(function(e){return t.idPromise?t.idPromise.then(function(t){return e.removePoint(t)}):Promise.resolve()})}})}]);